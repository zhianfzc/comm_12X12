#include "isp_type.h"
#include "isp_print.h"
#include "isp_i2c.h"
#include "isp_sns_ctrl.h"
#include "XAx_cmos.h"

// mclk: 27M
// mipi: 2lane 10bit pclk:74.25M 
static const ISP_U16 gau16SnsInit_sc200AI[][2] = {
	{0x0100,0x00},
	{0x36e9,0x80},
	{0x36f9,0x80},
	{0x301f,0x0d},
	{0x3200,0x00},
	{0x3201,0x00},
	{0x3202,0x00},
	{0x3203,0x00},
	{0x3204,0x07},
	{0x3205,0x8b},
	{0x3206,0x04},
	{0x3207,0x43},
	{0x3208,0x07},
	{0x3209,0x88},
	{0x320a,0x04},
	{0x320b,0x40},
	{0x320c,0x05},
	{0x320d,0x28},
	{0x3210,0x00},
	{0x3211,0x02},
	{0x3212,0x00},
	{0x3213,0x02},
	{0x3243,0x01},
	{0x3248,0x02},
	{0x3249,0x09},
	{0x3253,0x08},
	{0x3271,0x0a},
	{0x3301,0x20},
	{0x3304,0x40},
	{0x3306,0x32},
	{0x330b,0x88},
	{0x330f,0x02},
	{0x331e,0x39},
	{0x3333,0x10},
	{0x3621,0xe8},
	{0x3622,0x16},
	{0x3637,0x1b},
	{0x363a,0x1f},
	{0x363b,0xc6},
	{0x363c,0x0e},
	{0x3670,0x0a},
	{0x3674,0x82},
	{0x3675,0x76},
	{0x3676,0x78},
	{0x367c,0x48},
	{0x367d,0x58},
	{0x3690,0x34},
	{0x3691,0x33},
	{0x3692,0x44},
	{0x369c,0x40},
	{0x369d,0x48},
	{0x3901,0x02},
	{0x3904,0x04},
	{0x3908,0x41},
	{0x391d,0x14},
	{0x391f,0x18},
	{0x3e01,0x8c},
	{0x3e02,0x20},
	{0x3e16,0x00},
	{0x3e17,0x80},
	{0x3f09,0x48},
	{0x5787,0x10},
	{0x5788,0x06},
	{0x578a,0x10},
	{0x578b,0x06},
	{0x5790,0x10},
	{0x5791,0x10},
	{0x5792,0x00},
	{0x5793,0x10},
	{0x5794,0x10},
	{0x5795,0x00},
	{0x5799,0x00},
	{0x57c7,0x10},
	{0x57c8,0x06},
	{0x57ca,0x10},
	{0x57cb,0x06},
	{0x57d1,0x10},
	{0x57d4,0x10},
	{0x57d9,0x00},
	{0x59e0,0x60},
	{0x59e1,0x08},
	{0x59e2,0x3f},
	{0x59e3,0x18},
	{0x59e4,0x18},
	{0x59e5,0x3f},
	{0x59e6,0x06},
	{0x59e7,0x02},
	{0x59e8,0x38},
	{0x59e9,0x10},
	{0x59ea,0x0c},
	{0x59eb,0x10},
	{0x59ec,0x04},
	{0x59ed,0x02},
	{0x59ee,0xa0},
	{0x59ef,0x08},
	{0x59f4,0x18},
	{0x59f5,0x10},
	{0x59f6,0x0c},
	{0x59f7,0x10},
	{0x59f8,0x06},
	{0x59f9,0x02},
	{0x59fa,0x18},
	{0x59fb,0x10},
	{0x59fc,0x0c},
	{0x59fd,0x10},
	{0x59fe,0x04},
	{0x59ff,0x02},
	{0x4800,0x44},		// MIPI时钟连续
	{0x36e9,0x20},
	{0x36f9,0x27},
	{0x0100,0x01},
};

static const ISP_U16 gau16SnsInit_sc200AI_720p_HDR[][2] = {
	//{0x0103, 0x01},
	{0x0100, 0x00},
	{0x36e9, 0x80},
	{0x36f9, 0x80},
	{0x301f, 0x37},
	{0x3200, 0x01},
	{0x3201, 0x40},
	{0x3202, 0x00},
	{0x3203, 0xb4},
	{0x3204, 0x06},
	{0x3205, 0x47},
	{0x3206, 0x03},
	{0x3207, 0x8b},
	{0x3208, 0x05},
	{0x3209, 0x00},
	{0x320a, 0x02},
	{0x320b, 0xd0},
	{0x320c, 0x03},
	{0x320d, 0xde},
	{0x320e, 0x05},
	{0x320f, 0xdc},
	{0x3210, 0x00},
	{0x3211, 0x04},
	{0x3212, 0x00},
	{0x3213, 0x04},
	{0x3220, 0x53},
	{0x3243, 0x01},
	{0x3248, 0x02},
	{0x3249, 0x09},
	{0x3250, 0xff},
	{0x3253, 0x08},
	{0x3271, 0x0a},
	{0x3301, 0x06},
	{0x3302, 0x0c},
	{0x3303, 0x08},
	{0x3304, 0x50},
	{0x3306, 0x28},
	{0x3308, 0x10},
	{0x3309, 0x60},
	{0x330b, 0x78},
	{0x330d, 0x0c},
	{0x330e, 0x1c},
	{0x330f, 0x02},
	{0x3310, 0x02},
	{0x331c, 0x04},
	{0x331e, 0x41},
	{0x331f, 0x51},
	{0x3320, 0x07},
	{0x3333, 0x10},
	{0x334c, 0x08},
	{0x3356, 0x09},
	{0x3364, 0x17},
	{0x3390, 0x08},
	{0x3391, 0x18},
	{0x3392, 0x38},
	{0x3393, 0x06},
	{0x3394, 0x06},
	{0x3395, 0x06},
	{0x3396, 0x08},
	{0x3397, 0x18},
	{0x3398, 0x38},
	{0x3399, 0x06},
	{0x339a, 0x0a},
	{0x339b, 0x10},
	{0x339c, 0x20},
	{0x33ac, 0x08},
	{0x33ae, 0x10},
	{0x33af, 0x19},
	{0x3621, 0xe8},
	{0x3622, 0x16},
	{0x3630, 0xa0},
	{0x3637, 0x36},
	{0x363a, 0x1f},
	{0x363b, 0xc6},
	{0x363c, 0x0e},
	{0x3651, 0x7f},	// 0x7d  mipi_drv_lp
	{0x3654, 0x02},
	{0x3670, 0x0a},
	{0x3674, 0x82},
	{0x3675, 0x76},
	{0x3676, 0x78},
	{0x367c, 0x48},
	{0x367d, 0x58},
	{0x3690, 0x34},
	{0x3691, 0x33},
	{0x3692, 0x44},
	{0x369c, 0x40},
	{0x369d, 0x48},
	{0x36eb, 0x3c},
	{0x36ec, 0x0c},
	{0x36fc, 0x11},
	{0x36fd, 0x14},
	{0x3901, 0x02},
	{0x3904, 0x04},
	{0x3908, 0x41},
	{0x391f, 0x10},
	{0x3e00, 0x00},
	{0x3e01, 0xac},
	{0x3e02, 0x00},
	{0x3e04, 0x0a},
	{0x3e05, 0xc0},
	{0x3e06, 0x00},
	{0x3e07, 0x80},
	{0x3e08, 0x03},
	{0x3e09, 0x40},
	{0x3e10, 0x00},
	{0x3e11, 0x80},
	{0x3e12, 0x03},
	{0x3e13, 0x40},
	{0x3e16, 0x00},
	{0x3e17, 0x80},
	
	//{0x3e23, 0x00},
	//{0x3e24, 0x5b},
	//{0x3e23, 0x01},
	//{0x3e24, 0x40},
	{0x3e23, 0x00},
	{0x3e24, 0x58},	// 0xa0
	
	{0x3f09, 0x48},
	{0x4800, 0x44},
	{0x4816, 0xb1},
	{0x4819, 0x05},
	{0x481b, 0x03},
	{0x481d, 0x0a},
	{0x481f, 0x02},
	{0x4821, 0x08},
	{0x4823, 0x03},
	{0x4825, 0x02},
	{0x4827, 0x03},
	{0x4829, 0x04},
	{0x5787, 0x10},
	{0x5788, 0x06},
	{0x578a, 0x10},
	{0x578b, 0x06},
	{0x5790, 0x10},
	{0x5791, 0x10},
	{0x5792, 0x00},
	{0x5793, 0x10},
	{0x5794, 0x10},
	{0x5795, 0x00},
	{0x5799, 0x00},
	{0x57c7, 0x10},
	{0x57c8, 0x06},
	{0x57ca, 0x10},
	{0x57cb, 0x06},
	{0x57d1, 0x10},
	{0x57d4, 0x10},
	{0x57d9, 0x00},
	{0x59e0, 0x60},
	{0x59e1, 0x08},
	{0x59e2, 0x3f},
	{0x59e3, 0x18},
	{0x59e4, 0x18},
	{0x59e5, 0x3f},
	{0x59e6, 0x06},
	{0x59e7, 0x02},
	{0x59e8, 0x38},
	{0x59e9, 0x10},
	{0x59ea, 0x0c},
	{0x59eb, 0x10},
	{0x59ec, 0x04},
	{0x59ed, 0x02},
	{0x59ee, 0xa0},
	{0x59ef, 0x08},
	{0x59f4, 0x18},
	{0x59f5, 0x10},
	{0x59f6, 0x0c},
	{0x59f7, 0x10},
	{0x59f8, 0x06},
	{0x59f9, 0x02},
	{0x59fa, 0x18},
	{0x59fb, 0x10},
	{0x59fc, 0x0c},
	{0x59fd, 0x10},
	{0x59fe, 0x04},
	{0x59ff, 0x02},
	{0x36e9, 0x20},
	{0x36f9, 0x20},
	{0x0100, 0x01}
};

// MCLK: 27M
// PCLK: 74.25M
// Fps: 25fps*2(HDR_VC)  ---24.97fps
// totalSize: 2640*1126
// Acitve: 1920*1080
// mipi_2lane_10bit
static const ISP_U16 gau16SnsInit_sc200AI_1080P_HDR[][2] = {
	{0x0100,0x00},
	{0x36e9,0x80},
	{0x36f9,0x80},
	{0x301f,0x11},
	{0x3200,0x00},
	{0x3201,0x00},
	{0x3202,0x00},
	{0x3203,0x00},
	{0x3204,0x07},
	{0x3205,0x8b},
	{0x3206,0x04},
	{0x3207,0x43},
	{0x3208,0x07},
	{0x3209,0x88},
	{0x320a,0x04},
	{0x320b,0x40},
	{0x320c,0x05},
	{0x320d,0x28},
	{0x320e,0x08},
	{0x320f,0xcc},
	{0x3210,0x00},
	{0x3211,0x02},
	{0x3212,0x00},
	{0x3213,0x02},
	{0x3220,0x53},
	{0x3243,0x01},
	{0x3248,0x02},
	{0x3249,0x09},
	{0x3250,0x3f},
	{0x3253,0x08},
	{0x3271,0x0a},
	{0x3301,0x06},
	{0x3302,0x0c},
	{0x3303,0x08},
	{0x3304,0x60},
	{0x3306,0x30},
	{0x3308,0x10},
	{0x3309,0x70},
	{0x330b,0x80},
	{0x330d,0x16},
	{0x330e,0x1c},
	{0x330f,0x02},
	{0x3310,0x02},
	{0x331c,0x04},
	{0x331e,0x51},
	{0x331f,0x61},
	{0x3320,0x07},
	{0x3333,0x10},
	{0x3347,0x77},
	{0x334c,0x08},
	{0x3356,0x09},
	{0x3364,0x17},
	{0x336c,0xcc},
	{0x3390,0x08},
	{0x3391,0x18},
	{0x3392,0x38},
	{0x3393,0x06},
	{0x3394,0x06},
	{0x3395,0x06},
	{0x3396,0x08},
	{0x3397,0x18},
	{0x3398,0x38},
	{0x3399,0x06},
	{0x339a,0x0a},
	{0x339b,0x10},
	{0x339c,0x20},
	{0x33ac,0x08},
	{0x33ae,0x10},
	{0x33af,0x19},
	{0x3621,0xe8},
	{0x3622,0x16},
	{0x3630,0xa0},
	{0x3637,0x36},
	{0x363a,0x1f},
	{0x363b,0xc6},
	{0x363c,0x0e},
	{0x3670,0x0a},
	{0x3674,0x82},
	{0x3675,0x76},
	{0x3676,0x78},
	{0x367c,0x48},
	{0x367d,0x58},
	{0x3690,0x34},
	{0x3691,0x33},
	{0x3692,0x44},
	{0x369c,0x40},
	{0x369d,0x48},
	{0x36eb,0x0c},
	{0x36ec,0x0c},
	{0x36fd,0x14},
	{0x3901,0x02},
	{0x3904,0x04},
	{0x3908,0x41},
	{0x391f,0x10},
	{0x3e00,0x01},
	{0x3e01,0x06},
	{0x3e02,0x00},
	{0x3e04,0x10},
	{0x3e05,0x60},
	{0x3e06,0x00},
	{0x3e07,0x80},
	{0x3e08,0x03},
	{0x3e09,0x40},
	{0x3e10,0x00},
	{0x3e11,0x80},
	{0x3e12,0x03},
	{0x3e13,0x40},
	{0x3e16,0x00},
	{0x3e17,0x80},
#if 1	// 16:1
	{0x3e23,0x00},
	{0x3e24,0x88},
#else	// 8:1
	{0x3e23,0x00},
	{0x3e24,0xFE},
#endif
	{0x3f09,0x48},
	{0x4816,0xb1},
	{0x4819,0x09},
	{0x481b,0x05},
	{0x481d,0x14},
	{0x481f,0x04},
	{0x4821,0x0a},
	{0x4823,0x05},
	{0x4825,0x04},
	{0x4827,0x05},
	{0x4829,0x08},
	{0x5787,0x10},
	{0x5788,0x06},
	{0x578a,0x10},
	{0x578b,0x06},
	{0x5790,0x10},
	{0x5791,0x10},
	{0x5792,0x00},
	{0x5793,0x10},
	{0x5794,0x10},
	{0x5795,0x00},
	{0x5799,0x00},
	{0x57c7,0x10},
	{0x57c8,0x06},
	{0x57ca,0x10},
	{0x57cb,0x06},
	{0x57d1,0x10},
	{0x57d4,0x10},
	{0x57d9,0x00},
	{0x59e0,0x60},
	{0x59e1,0x08},
	{0x59e2,0x3f},
	{0x59e3,0x18},
	{0x59e4,0x18},
	{0x59e5,0x3f},
	{0x59e6,0x06},
	{0x59e7,0x02},
	{0x59e8,0x38},
	{0x59e9,0x10},
	{0x59ea,0x0c},
	{0x59eb,0x10},
	{0x59ec,0x04},
	{0x59ed,0x02},
	{0x59ee,0xa0},
	{0x59ef,0x08},
	{0x59f4,0x18},
	{0x59f5,0x10},
	{0x59f6,0x0c},
	{0x59f7,0x10},
	{0x59f8,0x06},
	{0x59f9,0x02},
	{0x59fa,0x18},
	{0x59fb,0x10},
	{0x59fc,0x0c},
	{0x59fd,0x10},
	{0x59fe,0x04},
	{0x59ff,0x02},
	{0x36e9,0x20},
	{0x36f9,0x24},
	{0x4800,0x44},		// MIPI时钟连续
	{0x0100,0x01}
};

// MCLK: 27M
// PCLK: 45M
// Fps: 25fps
// totalSize: 2400*750
// Acitve: 1288*728
// mipi_2lane_10bit
static const ISP_U16 gau16SnsInit_sc200AI_720P[][2] = {
	{0x0103,0x01},
	{0x0100,0x00},
	{0x36e9,0x80},
	{0x36f9,0x80},
	{0x301f,0x74},
	{0x3200,0x01},
	{0x3201,0x3c},
	{0x3202,0x00},
	{0x3203,0xb2},
	{0x3204,0x06},
	{0x3205,0x4b},
	{0x3206,0x03},
	{0x3207,0x8d},
	{0x3208,0x05},
	{0x3209,0x08},
	{0x320a,0x02},
	{0x320b,0xd8},
	{0x320c,0x04},
	{0x320d,0xb0},
	{0x320e,0x02},
	{0x320f,0xee},
	{0x3210,0x00},
	{0x3211,0x04},
	{0x3212,0x00},
	{0x3213,0x02},
	{0x3243,0x01},
	{0x3248,0x02},
	{0x3249,0x09},
	{0x3253,0x08},
	{0x3271,0x0a},
	{0x3301,0x20},
	{0x3304,0x40},
	{0x3306,0x32},
	{0x330b,0x8b},
	{0x330f,0x02},
	{0x331e,0x39},
	{0x3333,0x10},
	{0x3621,0xe8},
	{0x3622,0x16},
	{0x3637,0x1b},
	{0x363a,0x1f},
	{0x363b,0xc6},
	{0x363c,0x0e},
	{0x3670,0x0a},
	{0x3674,0x82},
	{0x3675,0x76},
	{0x3676,0x78},
	{0x367c,0x48},
	{0x367d,0x58},
	{0x3690,0x34},
	{0x3691,0x33},
	{0x3692,0x44},
	{0x369c,0x40},
	{0x369d,0x48},
	{0x36ea,0x3b},
	{0x36eb,0x0d},
	{0x36ec,0x1c},
	{0x36ed,0x24},
	{0x36fa,0x36},
	{0x36fb,0x00},
	{0x36fc,0x10},
	{0x36fd,0x14},
	{0x3901,0x02},
	{0x3904,0x04},
	{0x3908,0x41},
	{0x391d,0x14},
	{0x391f,0x18},
	{0x3e00,0x00},
	{0x3e01,0x5d},
	{0x3e02,0x40},
	{0x3e16,0x00},
	{0x3e17,0x80},
	{0x3f09,0x48},
	{0x4800,0x44},
	{0x4819,0x04},
	{0x481b,0x02},
	{0x481d,0x06},
	{0x481f,0x02},
	{0x4821,0x07},
	{0x4823,0x02},
	{0x4825,0x02},
	{0x4827,0x02},
	{0x4829,0x03},
	{0x5787,0x10},
	{0x5788,0x06},
	{0x578a,0x10},
	{0x578b,0x06},
	{0x5790,0x10},
	{0x5791,0x10},
	{0x5792,0x00},
	{0x5793,0x10},
	{0x5794,0x10},
	{0x5795,0x00},
	{0x5799,0x00},
	{0x57c7,0x10},
	{0x57c8,0x06},
	{0x57ca,0x10},
	{0x57cb,0x06},
	{0x57d1,0x10},
	{0x57d4,0x10},
	{0x57d9,0x00},
	{0x59e0,0x60},
	{0x59e1,0x08},
	{0x59e2,0x3f},
	{0x59e3,0x18},
	{0x59e4,0x18},
	{0x59e5,0x3f},
	{0x59e6,0x06},
	{0x59e7,0x02},
	{0x59e8,0x38},
	{0x59e9,0x10},
	{0x59ea,0x0c},
	{0x59eb,0x10},
	{0x59ec,0x04},
	{0x59ed,0x02},
	{0x59ee,0xa0},
	{0x59ef,0x08},
	{0x59f4,0x18},
	{0x59f5,0x10},
	{0x59f6,0x0c},
	{0x59f7,0x10},
	{0x59f8,0x06},
	{0x59f9,0x02},
	{0x59fa,0x18},
	{0x59fb,0x10},
	{0x59fc,0x0c},
	{0x59fd,0x10},
	{0x59fe,0x04},
	{0x59ff,0x02},
	{0x36e9,0x44},
	{0x36f9,0x20},
	{0x0100,0x01},
};


void sensor_init_sc200AI(ISP_DEV IspDev)
{
	ISP_U16 u16Num,u16i;
	if(WDR_MODE_2To1_LINE == gstSnsAttr[IspDev].enHdrMode)
	{
		if(gstSnsAttr[IspDev].enRsltType == P720_)		// 720P_HDR
		{
			u16Num = sizeof(gau16SnsInit_sc200AI_720p_HDR)/sizeof(gau16SnsInit_sc200AI_720p_HDR[0]);
			for(u16i=0; u16i < u16Num; u16i++)
			{
				sensor_write_register(IspDev,(ISP_U32)gau16SnsInit_sc200AI_720p_HDR[u16i][0], (ISP_U32)gau16SnsInit_sc200AI_720p_HDR[u16i][1]);
			}
			DEBUG("------------- sc200AI 720P HDR 25fps  init ok!----------------\n");
		}
		else											// 1080P_HDR
		{
			u16Num = sizeof(gau16SnsInit_sc200AI_1080P_HDR)/sizeof(gau16SnsInit_sc200AI_1080P_HDR[0]);
			for(u16i=0; u16i < u16Num; u16i++)
			{
				sensor_write_register(IspDev,(ISP_U32)gau16SnsInit_sc200AI_1080P_HDR[u16i][0], (ISP_U32)gau16SnsInit_sc200AI_1080P_HDR[u16i][1]);
			}
			DEBUG("------------- sc200AI 1080P HDR 25fps init ok!@20210910----------------\n");
		}
	}
	else
	{
		if(gstSnsAttr[IspDev].enRsltType == P720_)
		{
			u16Num = sizeof(gau16SnsInit_sc200AI_720P)/sizeof(gau16SnsInit_sc200AI_720P[0]);
			for(u16i=0; u16i < u16Num; u16i++)
			{
				sensor_write_register(IspDev,(ISP_U32)gau16SnsInit_sc200AI_720P[u16i][0], (ISP_U32)gau16SnsInit_sc200AI_720P[u16i][1]);
			}
			DEBUG("------------- sc200AI_720P linear 25fps  init ok!----------------\n");
		}
		else
		{
			u16Num = sizeof(gau16SnsInit_sc200AI)/sizeof(gau16SnsInit_sc200AI[0]);
			for(u16i=0; u16i < u16Num; u16i++)
			{
				sensor_write_register(IspDev,(ISP_U32)gau16SnsInit_sc200AI[u16i][0], (ISP_U32)gau16SnsInit_sc200AI[u16i][1]);
			}
			DEBUG("------------- sc200AI_1080P linear 25fps  init ok!----------------\n");
		}
	}
	XM_MPI_ISP_USleep(20000);
	
}




