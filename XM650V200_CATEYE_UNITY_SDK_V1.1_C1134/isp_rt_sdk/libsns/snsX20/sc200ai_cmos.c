#include "isp_type.h"
#include "isp_comm_isp.h"
#include "isp_comm_sns.h"
#include "isp_sns_ctrl.h"
#include "mpi_isp.h"
#include "mpi_ae.h"
#include "mpi_awb.h"
#include "isp_awb_comm.h"
#include "XAx_cmos.h"
#include "isp_print.h"

#define LINEAR_MAX_SHUTTER_OFST		(4)

#define HDR_HD720_25P_LINES			(1500)
#define HDR_HD720P_EXPL_MAX			(1412)			//{0x320e,0x320f} - {0x3e23,0x3e24} - 5
#define HDR_HD720P_EXPS_MAX  		(83)			//{0x3e23,0x3e24} - 5

#if 0 	// 16:1
#define HDR_HD1080_25P_LINES		(2252)
#define HDR_HD1080P_EXPL_MAX		(2111)			//{0x320e,0x320f} - {0x3e23,0x3e24} - 5
#define HDR_HD1080P_EXPS_MAX  		(131)			//{0x3e23,0x3e24} - 5
#else	// 8:1
#define HDR_HD1080_25P_LINES		(2252)
#define HDR_HD1080P_EXPL_MAX		(1993)			//{0x320e,0x320f} - {0x3e23,0x3e24} - 5
#define HDR_HD1080P_EXPS_MAX  		(249)			//{0x3e23,0x3e24} - 5
#endif
#define P720_25P_LINES		(750)


static const ISP_CMOS_AGC_TABLE_S g_stIspAgcTable_sc200AI_1M = {
	/* bvalid */
	1,
	/* 100, 200, 400, 800, 1600, 3200, 6400, 12800; 100, 200, 400, 800, 1600, 3200, 6400, 12800 */
	/* snr_thresh 2DNr		*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* drc	*/
	{0x32,0x23,0x14,0x0a,0x08,0x05,0x05,0x05,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},
	/* defog	*/
	{0x28,0x28,0x20,0x1a,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
	/* defog_vpss	*/
	{0x30,0x30,0x30,0x25,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20}, 
	/* DyDpc_thresh 		*/
	{0x96,0xb4,0xc8,0xc8,0xe6,0xFF,0xFF,0xFF,0xFF,0xD8,0xD8,0xD8,0xD8,0xD8,0xD8,0xD8},	 
	/* saturation_strength */
	{0x96,0x96,0x94,0x94,0x94,0x8c,0x84,0x78,0x78,0x78,0x20,0x20,0x20,0x20,0x20,0x20},
	/* Blc	*/
	{0x104,0x104,0x104,0x104,0x0ff,0x0ff,0x0fa,0x0f5,0x0f5,0x104,0x104,0x104,0x104,0x104,0x104,0x104},
	/* Contrast*/ 
	{0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32}
};
static const ISP_CMOS_SHARPEN_S gstSharpenColor_sc200AI_1M = {
	/* bvalid */
	1,
	/* 100, 200, 400, 800, 1600, 3200, 6400, 12800, 25600, 51200, 102400, 204800, 409600, 819200, 1638400, 3276800 */
	/* Ud*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* D*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*ThrUd*/
	{0x00,0x00,0x00,0x01,0x04,0x04,0x05,0x07,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03},
	/*ThrD*/
	{0x00,0x00,0x00,0x01,0x04,0x04,0x05,0x07,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03},	
	/*Ud_H*/
	{0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*D_H*/
	{0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*ThrUd_H*/
	{0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03},
	/*ThrD_H*/
	{0x03,0x03,0x03,0x03,0x03,0x06,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},
	/*EdgeStr*/
	{0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x1e,0x14,0x14,0x30,0x30,0x30,0x30,0x30,0x30},
	/*EdgeThr*/
	{0x00,0x00,0x00,0x00,0x00,0x02,0x03,0x04,0x06,0x04,0x00,0x00,0x00,0x00,0x00,0x00},
	/*OverShoot*/
	{0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0xFF,0xFF,0xFF,0xFF,0xFF},
	/*UnderShoot*/
	{0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0xFF,0xFF,0xFF,0xFF,0xFF},
	/*DetailStr*/
	{0x1e,0x1e,0x1e,0x1e,0x1e,0x1e,0x14,0x0d,0x0a,0x14,0x14,0x14,0x14,0x14,0x14,0x14},
	/*Rsv1*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*Rsv2*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
};

static const ISP_CMOS_SHARPEN_S gstSharpenBw_sc200AI_1M = {
	/* bvalid */
	1,
	/* 100, 200, 400, 800, 1600, 3200, 6400, 12800, 25600, 51200, 102400, 204800, 409600, 819200, 1638400, 3276800 */
	/* Ud*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* D*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*ThrUd*/
	{0x00,0x00,0x00,0x01,0x04,0x04,0x05,0x07,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03},
	/*ThrD*/
	{0x00,0x00,0x00,0x01,0x04,0x04,0x05,0x07,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03},	
	/*Ud_H*/
	{0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*D_H*/
	{0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*ThrUd_H*/
	{0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03},
	/*ThrD_H*/
	{0x03,0x03,0x03,0x03,0x03,0x06,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},
	/*EdgeStr*/
	{0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x1e,0x14,0x14,0x30,0x30,0x30,0x30,0x30,0x30},
	/*EdgeThr*/
	{0x00,0x00,0x00,0x00,0x00,0x02,0x03,0x04,0x06,0x04,0x00,0x00,0x00,0x00,0x00,0x00},
	/*OverShoot*/
	{0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0xFF,0xFF,0xFF,0xFF,0xFF},
	/*UnderShoot*/
	{0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0xFF,0xFF,0xFF,0xFF,0xFF},
	/*DetailStr*/
	{0x1e,0x1e,0x1e,0x1e,0x1e,0x1e,0x14,0x0d,0x0a,0x14,0x14,0x14,0x14,0x14,0x14,0x14},
	/*Rsv1*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*Rsv2*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
};

static const ISP_CMOS_2DNR_S gst2DNr_sc200AI_1M = {
	0x01,
	{0x04,0x04,0x04,0x04,0x04,0x08,0x08,0x08,0x08,0x08,0x04,0x04,0x04,0x04,0x04,0x04},
	{0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},
	{0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80},
	{0x40,0x40,0x40,0x40,0x40,0x32,0x20,0x10,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00},
	{0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04},
	{0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},
	{0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80},
	{0x40,0x40,0x40,0x40,0x40,0x32,0x20,0x10,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00},
};

static const ISP_CMOS_YCNR_S gstYCNr_sc200AI_1M = {
	0x01,	
	//Thresh
	{0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x06,0x06,0x06,0x06,0x06,0x06,0x06},
	//Str
	{0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x06,0x06,0x06,0x06,0x06,0x06,0x06},
	//MixStr
	{0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x06,0x06,0x06,0x06,0x06,0x06,0x06},
	//Wt1
	{0x00,0x01,0x01,0x01,0x01,0x02,0x02,0x02,0x02,0x02,0x06,0x06,0x06,0x06,0x06,0x06},
	//Wt2
	{0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x07,0x07,0x07,0x07,0x07,0x07},
	//Wt3
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	//Rsv
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}

};


static const ISP_CMOS_VPSS_3DNR_S gstVpss3DNr_sc200AI_1M = {
	0x01,
	/* 100, 200, 400, 800, 1600, 3200, 6400, 12800, 25600, 51200, 102400, 204800, 409600, 819200, 1638400, 3276800 */
	/* Flt_Thr	  */
	{0x04,0x04,0x04,0x06,0x08,0x10,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
	/* Df_RatC	  */
	{0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x04,0x04,0x04,0x04,0x04,0x04,0x04},
	/* Df1_RatioY	 */
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* Df1_RatioC	 */
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* MovThr_Max	 */
	{0x01,0x02,0x02,0x02,0x03,0x03,0x04,0x04,0x05,0x05,0x03,0x03,0x03,0x03,0x03,0x03},
	/* Alpha_Ratio	  */
	{0x73,0x6E,0x55,0x50,0x46,0x3d,0x2d,0x23,0x19,0x19,0x50,0x50,0x50,0x50,0x50,0x50},
	/* Alpha_Min	*/
	{0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07},
	/* IdxThr_Max	 */
	{0x19,0x19,0x19,0x19,0x19,0x19,0x18,0x18,0x18,0x18,0x22,0x22,0x22,0x22,0x22,0x22},
	/* IdxThr_Min	 */
	{0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x20,0x20,0x20,0x20,0x20,0x20},
	/* Idx_Max	  */
	{0x08,0x08,0x08,0x08,0x08,0x0c,0x10,0x1a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20},
	/* FidY    */
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* FidC    */
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* FidY_Min    */
	{0x01,0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04},
	/* FidC_Min    */
	{0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02},
	/* YSfThr_Min	 */
	{0x18,0x18,0x18,0x18,0x16,0x10,0x10,0x10,0x10,0x20,0x20,0x20,0x20,0x20,0x20,0x20},
	/* CSfThr_Min	 */
	{0x04,0x04,0x04,0x04,0x04,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06},
	/* YTfThr_Min	 */
	{0x02,0x03,0x04,0x05,0x06,0x06,0x06,0x0a,0x0c,0x14,0x14,0x14,0x14,0x14,0x14,0x14},
	/* CTfThr_Min	 */
	{0x02,0x03,0x04,0x05,0x08,0x0c,0x0c,0x0c,0x0c,0x14,0x14,0x14,0x14,0x14,0x14,0x14},
	/* YAntiRsdlSpd*/
	{0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04},
	/* CAntiRsdlSpd*/
	{0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06},
	/* YAntiRsdlThr*/
	{0x0f,0x0f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20},
	/* CAntiRsdlThr*/
	{0x0a,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20},
	/* YSfThr_K    */
	{0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400},
	/* CSfThr_K    */
	{0x0200,0x0200,0x0400,0x0700,0x0c00,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000},
	/* YTfThr_K    */
	{0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400},
	/* CTfThr_K    */
	{0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800},
	/* MovThr1	  */
	{0x2800,0x2800,0x2800,0x2800,0x2800,0x2800,0x2800,0x2800,0x2800,0x2800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800},
	/* MovThr2	  */
	{0x1400,0x1400,0x1400,0x1400,0x1400,0x1400,0x1400,0x1400,0x1400,0x1400,0x4000,0x4000,0x4000,0x4000,0x4000,0x4000},
	/* MovThr3	  */
	{0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000},

};



static const ISP_CMOS_AGC_TABLE_S g_stIspAgcTable_sc200AI = {
	/* bvalid */
	1,
	/* 100, 200, 400, 800, 1600, 3200, 6400, 12800; 100, 200, 400, 800, 1600, 3200, 6400, 12800 */
	/* snr_thresh 2DNr		*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* drc	*/
	{0x32,0x23,0x14,0x0a,0x08,0x05,0x05,0x05,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},
	/* defog	*/
	{0x28,0x28,0x20,0x1a,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
	/* defog_vpss	*/
	{0x30,0x30,0x30,0x25,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20}, 
	/* DyDpc_thresh 		*/
	{0x96,0xb4,0xc8,0xc8,0xe6,0xFF,0xFF,0xFF,0xFF,0xD8,0xD8,0xD8,0xD8,0xD8,0xD8,0xD8},	 
	/* saturation_strength */
	{0x96,0x96,0x94,0x94,0x94,0x8c,0x84,0x78,0x78,0x78,0x20,0x20,0x20,0x20,0x20,0x20},
	/* Blc	*/
	{0x104,0x104,0x104,0x104,0x0ff,0x0ff,0x0fa,0x0f5,0x0f5,0x104,0x104,0x104,0x104,0x104,0x104,0x104},
	/* Contrast*/ 
	{0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32,0x32}
};
static const ISP_CMOS_SHARPEN_S gstSharpenColor_sc200AI = {
	/* bvalid */
	1,
	/* 100, 200, 400, 800, 1600, 3200, 6400, 12800, 25600, 51200, 102400, 204800, 409600, 819200, 1638400, 3276800 */
	/* Ud*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* D*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*ThrUd*/
	{0x00,0x00,0x00,0x01,0x04,0x04,0x05,0x07,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03},
	/*ThrD*/
	{0x00,0x00,0x00,0x01,0x04,0x04,0x05,0x07,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03},	
	/*Ud_H*/
	{0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*D_H*/
	{0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*ThrUd_H*/
	{0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03},
	/*ThrD_H*/
	{0x03,0x03,0x03,0x03,0x03,0x06,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},
	/*EdgeStr*/
	{0x28,0x28,0x28,0x28,0x28,0x28,0x28,0x1e,0x14,0x14,0x30,0x30,0x30,0x30,0x30,0x30},
	/*EdgeThr*/
	{0x00,0x00,0x00,0x00,0x00,0x02,0x03,0x04,0x06,0x04,0x00,0x00,0x00,0x00,0x00,0x00},
	/*OverShoot*/
	{0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0x5f,0xFF,0xFF,0xFF,0xFF,0xFF},
	/*UnderShoot*/
	{0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0x6e,0xFF,0xFF,0xFF,0xFF,0xFF},
	/*DetailStr*/
	{0x1e,0x1e,0x1e,0x1e,0x1e,0x1e,0x14,0x0d,0x0a,0x14,0x14,0x14,0x14,0x14,0x14,0x14},
	/*Rsv1*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/*Rsv2*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
};
static const ISP_CMOS_2DNR_S gst2DNr_sc200AI = {
	0x01,
	{0x04,0x04,0x04,0x04,0x04,0x08,0x08,0x08,0x08,0x08,0x04,0x04,0x04,0x04,0x04,0x04},
	{0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},
	{0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80},
	{0x40,0x40,0x40,0x40,0x40,0x32,0x20,0x10,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00},
	{0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04},
	{0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08},
	{0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80},
	{0x40,0x40,0x40,0x40,0x40,0x32,0x20,0x10,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00},
};
static const ISP_CMOS_VPSS_3DNR_S gstVpss3DNr_sc200AI = {
	0x01,
	/* 100, 200, 400, 800, 1600, 3200, 6400, 12800, 25600, 51200, 102400, 204800, 409600, 819200, 1638400, 3276800 */
	/* Flt_Thr	  */
	{0x04,0x04,0x04,0x06,0x08,0x10,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18},
	/* Df_RatC	  */
	{0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x04,0x04,0x04,0x04,0x04,0x04,0x04},
	/* Df1_RatioY	 */
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* Df1_RatioC	 */
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* MovThr_Max	 */
	{0x01,0x02,0x02,0x02,0x03,0x03,0x04,0x04,0x05,0x05,0x03,0x03,0x03,0x03,0x03,0x03},
	/* Alpha_Ratio	  */
	{0x73,0x6E,0x55,0x50,0x46,0x3d,0x2d,0x23,0x19,0x19,0x50,0x50,0x50,0x50,0x50,0x50},
	/* Alpha_Min	*/
	{0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07},
	/* IdxThr_Max	 */
	{0x19,0x19,0x19,0x19,0x19,0x19,0x18,0x18,0x18,0x18,0x22,0x22,0x22,0x22,0x22,0x22},
	/* IdxThr_Min	 */
	{0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x0c,0x20,0x20,0x20,0x20,0x20,0x20},
	/* Idx_Max	  */
	{0x08,0x08,0x08,0x08,0x08,0x0c,0x10,0x1a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20},
	/* FidY    */
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* FidC    */
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	/* FidY_Min    */
	{0x01,0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04},
	/* FidC_Min    */
	{0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02},
	/* YSfThr_Min	 */
	{0x18,0x18,0x18,0x18,0x16,0x10,0x10,0x10,0x10,0x20,0x20,0x20,0x20,0x20,0x20,0x20},
	/* CSfThr_Min	 */
	{0x04,0x04,0x04,0x04,0x04,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06},
	/* YTfThr_Min	 */
	{0x02,0x03,0x04,0x05,0x06,0x06,0x06,0x0a,0x0c,0x14,0x14,0x14,0x14,0x14,0x14,0x14},
	/* CTfThr_Min	 */
	{0x02,0x03,0x04,0x05,0x08,0x0c,0x0c,0x0c,0x0c,0x14,0x14,0x14,0x14,0x14,0x14,0x14},
	/* YAntiRsdlSpd*/
	{0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04},
	/* CAntiRsdlSpd*/
	{0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06},
	/* YAntiRsdlThr*/
	{0x0f,0x0f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20},
	/* CAntiRsdlThr*/
	{0x0a,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20},
	/* YSfThr_K    */
	{0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400},
	/* CSfThr_K    */
	{0x0200,0x0200,0x0400,0x0700,0x0c00,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000},
	/* YTfThr_K    */
	{0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400,0x0400},
	/* CTfThr_K    */
	{0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800},
	/* MovThr1	  */
	{0x2800,0x2800,0x2800,0x2800,0x2800,0x2800,0x2800,0x2800,0x2800,0x2800,0x0800,0x0800,0x0800,0x0800,0x0800,0x0800},
	/* MovThr2	  */
	{0x1400,0x1400,0x1400,0x1400,0x1400,0x1400,0x1400,0x1400,0x1400,0x1400,0x4000,0x4000,0x4000,0x4000,0x4000,0x4000},
	/* MovThr3	  */
	{0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x0a00,0x1000,0x1000,0x1000,0x1000,0x1000,0x1000},

};
static const ISP_CMOS_YCNR_S gstYCNr_sc200AI = {
	0x01,	
	//Thresh
	{0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x06,0x06,0x06,0x06,0x06,0x06,0x06},
	//Str
	{0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x06,0x06,0x06,0x06,0x06,0x06,0x06},
	//MixStr
	{0x01,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x06,0x06,0x06,0x06,0x06,0x06,0x06},
	//Wt1
	{0x00,0x01,0x01,0x01,0x01,0x02,0x02,0x02,0x02,0x02,0x06,0x06,0x06,0x06,0x06,0x06},
	//Wt2
	{0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x07,0x07,0x07,0x07,0x07,0x07},
	//Wt3
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
	//Rsv
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}

};
static ISP_S32 cmos_get_isp_default(ISP_DEV IspDev, ISP_CMOS_DEFAULT_S *pstDef)
{
	ISP_U8 u8ColorBw = 0;	// 0:Color	1:Bw
	if (ISP_NULL == pstDef)
	{
		ERR("null pointer when get isp default value!\n");
		return -1;
	}
	if(P720_ == gstSnsAttr[IspDev].enRsltType)
	{
		gstCmosDnPara[IspDev].pastAgcTab[0] = &g_stIspAgcTable_sc200AI_1M;
		gstCmosDnPara[IspDev].pastAgcYcNr[0] = &gstYCNr_sc200AI_1M;
		gstCmosDnPara[IspDev].pastAgcSharp[0] = &gstSharpenColor_sc200AI_1M;
		gstCmosDnPara[IspDev].pastAgcSharp[1] = &gstSharpenBw_sc200AI_1M;
		gstCmosDnPara[IspDev].pastAgcVpss3DNr[0] = &gstVpss3DNr_sc200AI_1M;
		gstCmosDnPara[IspDev].pastGamma[0] = &gastIspGamma[0];
		gstCmosDnPara[IspDev].pastGamma[1] = &gastIspGamma[0];
		gstCmosDnPara[IspDev].pastAgcLtm[0] = &gstLtm;
		gstCmosDnPara[IspDev].past2DNr[0] = &gst2DNr_sc200AI_1M;
	}	
	else
	{
		gstCmosDnPara[IspDev].pastAgcTab[0] = &g_stIspAgcTable_sc200AI;
		gstCmosDnPara[IspDev].pastAgcYcNr[0] = &gstYCNr_sc200AI;
		gstCmosDnPara[IspDev].pastAgcSharp[0] = &gstSharpenColor_sc200AI;
		gstCmosDnPara[IspDev].pastAgcVpss3DNr[0] = &gstVpss3DNr_sc200AI;
		gstCmosDnPara[IspDev].pastGamma[0] = &gastIspGamma[1];
		gstCmosDnPara[IspDev].pastGamma[1] = &gastIspGamma[0];
		gstCmosDnPara[IspDev].pastAgcLtm[0] = &gstLtm;
		gstCmosDnPara[IspDev].past2DNr[0] = &gst2DNr_sc200AI;
	}
	if(gstCmosDnPara[IspDev].pastAgcTab[1] == NULL)
	{
		gstCmosDnPara[IspDev].pastAgcTab[1] = gstCmosDnPara[IspDev].pastAgcTab[0];
	}	
	if(gstCmosDnPara[IspDev].pastAgcYcNr[1] == NULL)
	{
		gstCmosDnPara[IspDev].pastAgcYcNr[1] = gstCmosDnPara[IspDev].pastAgcYcNr[0];
	}	
	if(gstCmosDnPara[IspDev].pastAgcSharp[1] == NULL)
	{
		gstCmosDnPara[IspDev].pastAgcSharp[1] = gstCmosDnPara[IspDev].pastAgcSharp[0];
	}
	if(gstCmosDnPara[IspDev].pastAgcVpss3DNr[1] == NULL)
	{
		gstCmosDnPara[IspDev].pastAgcVpss3DNr[1] = gstCmosDnPara[IspDev].pastAgcVpss3DNr[0];
	}
	if(gstCmosDnPara[IspDev].pastGamma[1] == NULL)
	{
		gstCmosDnPara[IspDev].pastGamma[1] = gstCmosDnPara[IspDev].pastGamma[0];
	}
	if(gstCmosDnPara[IspDev].pastAgcLtm[1] == NULL)
	{
		gstCmosDnPara[IspDev].pastAgcLtm[1] = gstCmosDnPara[IspDev].pastAgcLtm[0];
	}
	if(gstCmosDnPara[IspDev].past2DNr[1] == NULL)
	{
		gstCmosDnPara[IspDev].past2DNr[1] = gstCmosDnPara[IspDev].past2DNr[0];
	}
	pstDef->stGamma.bValid = ISP_TRUE;
	XM_MPI_ISP_Memncpy((ISP_U8*)&pstDef->stGamma, (ISP_U8*)(gstCmosDnPara[IspDev].pastGamma[u8ColorBw]), sizeof(ISP_CMOS_GAMMA_S));
	XM_MPI_ISP_Memncpy((ISP_U8*)&pstDef->stAgcTbl, (ISP_U8*)(gstCmosDnPara[IspDev].pastAgcTab[u8ColorBw]), sizeof(ISP_CMOS_AGC_TABLE_S));
	XM_MPI_ISP_Memncpy((ISP_U8*)&pstDef->stVpss3DNr, (ISP_U8*)(gstCmosDnPara[IspDev].pastAgcVpss3DNr[u8ColorBw]), sizeof(ISP_CMOS_VPSS_3DNR_S));
	XM_MPI_ISP_Memncpy((ISP_U8*)&pstDef->stSharpen, (ISP_U8*)(gstCmosDnPara[IspDev].pastAgcSharp[u8ColorBw]), sizeof(ISP_CMOS_SHARPEN_S));
	XM_MPI_ISP_Memncpy((ISP_U8*)&pstDef->stYcNr, (ISP_U8*)(gstCmosDnPara[IspDev].pastAgcYcNr[u8ColorBw]), sizeof(ISP_CMOS_YCNR_S));
	XM_MPI_ISP_Memncpy((ISP_U8*)&pstDef->stLtm, (ISP_U8*)(gstCmosDnPara[IspDev].pastAgcLtm[u8ColorBw]), sizeof(ISP_CMOS_LTM_S));
	XM_MPI_ISP_Memncpy((ISP_U8*)&pstDef->st2DNr, (ISP_U8*)(gstCmosDnPara[IspDev].past2DNr[u8ColorBw]), sizeof(ISP_CMOS_2DNR_S));
	XM_MPI_ISP_Memncpy((ISP_U8*)&pstDef->stShading, (ISP_U8*)&gstShading, sizeof(ISP_CMOS_SHADING_S));
	XM_MPI_ISP_Memncpy((ISP_U8*)&pstDef->stLocalCAC, (ISP_U8*)&gstLocalCAC, sizeof(ISP_CMOS_LOCAL_CAC_S));
	return 0;
}

static ISP_VOID cmos_set_pixel_detect(ISP_DEV IspDev, ISP_BOOL bEnable)
{
    return;
}

static ISP_S32 cmos_set_mirror_flip(ISP_DEV IspDev, ISP_U8 u8Mirror,ISP_U8 u8Flip)
{
	ISP_U32 u32Val;
	ISP_U16 u16OfstH,u16OfstV;
	ISPAPP_WIN_ATTR_S stWinAttr;
	u16OfstH = 0;
	u16OfstV = 0;
	u32Val = sensor_read_register(IspDev, 0x3221);
	if(u8Mirror)
	{
		u32Val |= 0x06;
	}
	else
	{
		u32Val &= ~0x06;
	}

	if(u8Flip)
	{
		u32Val |= 0x60;
	}
	else
	{
		u32Val &= ~0x60;
	}
	sensor_write_register(IspDev, 0x3221, u32Val);
	stWinAttr.u8Mode = 1;
	stWinAttr.u16ValH = u16OfstH;
	stWinAttr.u16ValV = u16OfstV;
	XM_MPI_ISPAPP_WinSet(IspDev, &stWinAttr);
	return ISP_SUCCESS;
}

#define DCG_GAIN_VAL	(3482)	// *1024
static ISP_VOID cmos_again_calc_table(ISP_DEV IspDev, ISP_U32 u32InTimes,AE_SENSOR_GAININFO_S *pstAeSnsGainInfo)
{
	ISP_U8 i;
	ISP_S32 dcg=0;
	if(ISP_NULL == pstAeSnsGainInfo)
	{
		return;
	}
	pstAeSnsGainInfo->u32GainDb = 0;
	pstAeSnsGainInfo->u32SnsTimes = 1024;
	if(u32InTimes>=DCG_GAIN_VAL)
	{
		dcg = 1;						//DCG
		u32InTimes=(ISP_U64)u32InTimes*1024/DCG_GAIN_VAL;
	}
	u32InTimes = u32InTimes>>4;
	u32InTimes = u32InTimes < 64? 64: u32InTimes;

	for(i = 0; i < 5; i++)
	{
		if(u32InTimes < 128)
		{
			break;
		}
		u32InTimes >>= 1;
		pstAeSnsGainInfo->u32GainDb = (pstAeSnsGainInfo->u32GainDb<<1)|1;
	}
	pstAeSnsGainInfo->u32GainDb = (dcg<<31)|(pstAeSnsGainInfo->u32GainDb<<8)|u32InTimes; 
	u32InTimes = u32InTimes<<(i+4);
	if(dcg)
	{
		u32InTimes = (ISP_U64)u32InTimes*DCG_GAIN_VAL/1024;
	}
	pstAeSnsGainInfo->u32SnsTimes = u32InTimes;
	gau32AGainNow[IspDev] = pstAeSnsGainInfo->u32SnsTimes;
	return;
}

static ISP_VOID cmos_dgain_calc_table(ISP_DEV IspDev, ISP_U32 u32InTimes,AE_SENSOR_GAININFO_S *pstAeSnsGainInfo)
{
	ISP_U8 i;
	if(ISP_NULL == pstAeSnsGainInfo)
	{
		return;
	}
	pstAeSnsGainInfo->u32GainDb = 0;
	u32InTimes = u32InTimes>>3;
	u32InTimes = MAX2(u32InTimes,128);
	for(i = 0; i < 5; i++)
	{
		if(u32InTimes < 256)
		{
			break;
		}
		u32InTimes >>= 1;
		pstAeSnsGainInfo->u32GainDb = (pstAeSnsGainInfo->u32GainDb<<1)|1;
	}
	u32InTimes = (u32InTimes>>1)<<1;
	pstAeSnsGainInfo->u32SnsTimes = u32InTimes<<(i+3);
	pstAeSnsGainInfo->u32GainDb = (pstAeSnsGainInfo->u32GainDb<<8)+u32InTimes;
	gau32DGainNow[IspDev] = pstAeSnsGainInfo->u32SnsTimes;
	return;
}

static ISP_S32 cmos_get_ae_default(ISP_DEV IspDev, AE_SENSOR_DEFAULT_S *pstAeSnsDft)
{
	if (ISP_NULL == pstAeSnsDft)
	{
		ERR("null pointer when get ae default value!\n");
		return -1;
	}
	if(WDR_MODE_2To1_LINE == gstSnsAttr[IspDev].enHdrMode)
	{
		if(gstSnsAttr[IspDev].enRsltType == P720_)
		{
			gau16FullLines[IspDev] = HDR_HD720_25P_LINES;
			gau16HdrExpMax_L[IspDev] = HDR_HD720P_EXPL_MAX;
			gau16HdrExpMax_S[IspDev] = HDR_HD720P_EXPS_MAX;
		}
		else
		{
			gau16FullLines[IspDev] = HDR_HD1080_25P_LINES;
			gau16HdrExpMax_L[IspDev] = HDR_HD1080P_EXPL_MAX;
			gau16HdrExpMax_S[IspDev] = HDR_HD1080P_EXPS_MAX;
		}
	}
	else
	{
		if(gstSnsAttr[IspDev].enRsltType == P720_)
		{
			gau16FullLines[IspDev] = P720_25P_LINES;
			gau16HdrExpMax_L[IspDev] = P720_25P_LINES-LINEAR_MAX_SHUTTER_OFST;
			gau16HdrExpMax_S[IspDev] = 1; 		
		}
		else
		{
			gau16FullLines[IspDev] = HD1080_25P_LINES;
			gau16HdrExpMax_L[IspDev] = HD1080_25P_LINES-LINEAR_MAX_SHUTTER_OFST;
			gau16HdrExpMax_S[IspDev] = 1; 
		}
	}
	pstAeSnsDft->u32FullLinesStd = gau16FullLines[IspDev];
	pstAeSnsDft->u8AeCompensation = 0x39;	
	pstAeSnsDft->u32LinesPer500ms = pstAeSnsDft->u32FullLinesStd*25/2;
	pstAeSnsDft->u32FlickerFreq = 0;

	pstAeSnsDft->u32MaxIntTime = gau16HdrExpMax_L[IspDev];
	pstAeSnsDft->u32MinIntTime = 2;    

	pstAeSnsDft->u32MaxAgain = 55270;
	pstAeSnsDft->u32MinAgain = 1024;

	pstAeSnsDft->u32MaxDgain = 32512;	
	pstAeSnsDft->u32MinDgain = 1024;

	pstAeSnsDft->u32ISPDgainShift = 8;
	pstAeSnsDft->u32MaxISPDgain= 8 << pstAeSnsDft->u32ISPDgainShift;
	pstAeSnsDft->u32MinISPDgain= 1 << pstAeSnsDft->u32ISPDgainShift;
	return 0;
}


static ISP_S32 cmos_get_sensor_max_resolution(ISP_DEV IspDev, ISP_CMOS_SENSOR_MAX_RESOLUTION *pstSensorMaxResolution)
{
	if (ISP_NULL == pstSensorMaxResolution)
	{
	    ERR("null pointer when get sensor max resolution \n");
	    return -1;
	}

	pstSensorMaxResolution->u32MaxWidth  = 1920;
	pstSensorMaxResolution->u32MaxHeight = 1080;
	return 0;
}

static ISP_VOID cmos_inttime_update(ISP_DEV IspDev, ISP_U32 u32IntTime)
{
	if(gau32ShutNow[IspDev] == u32IntTime)
		return ;
	gau32ShutNow[IspDev] = u32IntTime;
	u32IntTime = u32IntTime*2;
	sensor_write_register(IspDev, 0x3e02, ((u32IntTime&0xf)<<4));
	sensor_write_register(IspDev, 0x3e01, ((u32IntTime&0x0ff0)>>4));
	sensor_write_register(IspDev, 0x3e00, ((u32IntTime&0xf000)>>12));
	return;
}

static ISP_VOID cmos_inttime_short_update(ISP_DEV IspDev, ISP_U32 u32IntTime)
{
	u32IntTime = (u32IntTime < gau16HdrExpMax_S[IspDev])?u32IntTime:gau16HdrExpMax_S[IspDev]; 
	u32IntTime = u32IntTime*2;
	sensor_write_register(IspDev, 0x3e05, ((u32IntTime&0xf)<<4));
	sensor_write_register(IspDev, 0x3e04, ((u32IntTime&0x0ff0)>>4));
	sensor_write_register(IspDev, 0x3e22, ((u32IntTime&0xf000)>>12));
	return;
}

static ISP_VOID cmos_gains_update(ISP_DEV IspDev, ISP_U32 u32Again, ISP_U32 u32Dgain)
{
	static ISP_U32 sau32AGain[ISP_NUM_MAX] = {0xFFFFFFFE};
	static ISP_U32 sau32DGain[ISP_NUM_MAX] = {0xFFFFFFFE};
	ISP_U32 u32Tmp,tmp[4];
	ISP_U8 u8i;
	if(sau32AGain[0] == 0xFFFFFFFE)
	{
		for(u8i=0;u8i<ISP_NUM_MAX;u8i ++)
		{
			sau32AGain[u8i] = 0xFFFFFFFF;
			sau32DGain[u8i] = 0xFFFFFFFF;
		}
	}
	if((sau32AGain[IspDev] != u32Again) || (sau32DGain[IspDev] != u32Dgain))
	{
		sau32AGain[IspDev] = u32Again;
		sau32DGain[IspDev] = u32Dgain;
		// 2.GainUpdate
		tmp[0] = u32Again&0xFF; 
		u32Tmp = (u32Again>>8) & 0xFF;
		tmp[1] = 0x03 | (u32Tmp<<2);
		if(u32Again&(1<<31))	// DCG
		{
			tmp[1] |= 0x20;
		}

		tmp[2] = u32Dgain&0xFF; 
		tmp[3] = (u32Dgain>>8) & 0xFF;
		//long
		sensor_write_register(IspDev, 0x3e08, tmp[1]);
		sensor_write_register(IspDev, 0x3e09, tmp[0]);
		sensor_write_register(IspDev, 0x3e06, tmp[3]);
		sensor_write_register(IspDev, 0x3e07, tmp[2]);

		//Short 
		sensor_write_register(IspDev, 0x3e12, tmp[1]);
		sensor_write_register(IspDev, 0x3e13, tmp[0]);
		sensor_write_register(IspDev, 0x3e10, tmp[3]);
		sensor_write_register(IspDev, 0x3e11, tmp[2]);
	}
	return;
}

static ISP_VOID cmos_slow_framerate_set(ISP_DEV IspDev, ISP_U16 u16FullLines, AE_SENSOR_DEFAULT_S *pstAeSnsDft)
{
	WDR_MODE_E enHdrMode = gstSnsAttr[IspDev].enHdrMode;
	
	if(WDR_MODE_2To1_LINE != enHdrMode)
	{
		if(gau16FullLines[IspDev] == u16FullLines)
		{
			return;
		}
	
		gau16FullLines[IspDev] = u16FullLines;
		pstAeSnsDft->u32MaxIntTime = u16FullLines - LINEAR_MAX_SHUTTER_OFST;
		if(gau32ShutNow[IspDev]>pstAeSnsDft->u32MaxIntTime)
		{
			cmos_inttime_update(IspDev, pstAeSnsDft->u32MaxIntTime);
		}
		sensor_write_register(IspDev, 0x320e, (u16FullLines>>8)&0xFF);
		sensor_write_register(IspDev, 0x320f, u16FullLines&0xFF);	
		XM_MPI_MIPI_RefreshFV(IspDev,0, u16FullLines);
	}
}

static const ISP_U16 gau16FpsMode_Hdr[][3] = {
	//Addr  linear  hdr
//	{0x0100, 0x00, 0x00},
	{0x36e9, 0x80, 0x80},
	{0x36f9, 0x80, 0x80},
	{0x301f, 0x0d, 0x11},
	{0x3220, 0x13, 0x53},
	{0x3250, 0x00, 0x3f},
	{0x3301, 0x20, 0x06},
	{0x3304, 0x40, 0x60},
	{0x3306, 0x32, 0x30},
	{0x3308, 0x08, 0x10},
	{0x3309, 0x58, 0x70},
	{0x330b, 0x88, 0x80},
	{0x330d, 0x18, 0x16},
	{0x330e, 0x10, 0x1c},
	{0x331c, 0x02, 0x04},
	{0x331e, 0x39, 0x51},
	{0x331f, 0x51, 0x61},
	{0x3320, 0x03, 0x07},
	{0x3347, 0x00, 0x77},
	{0x3356, 0x19, 0x09},
	{0x3364, 0x07, 0x17},
	{0x336c, 0xce, 0xcc},
	{0x3391, 0x10, 0x18},
	{0x3392, 0x20, 0x38},
	{0x3393, 0x00, 0x06},
	{0x3394, 0x00, 0x06},
	{0x3395, 0x00, 0x06},
	{0x3397, 0x10, 0x18},
	{0x3398, 0x20, 0x38},
	{0x3399, 0x00, 0x06},
	{0x339a, 0x00, 0x0a},
	{0x339b, 0x00, 0x10},
	{0x339c, 0x00, 0x20},
	{0x33ac, 0x06, 0x08},
	{0x33ae, 0x0e, 0x10},
	{0x33af, 0x27, 0x19},
	{0x3630, 0x88, 0xa0},
	{0x3637, 0x1b, 0x36},
	{0x36eb, 0x0d, 0x0c},
	{0x36ec, 0x1c, 0x0c},
	{0x36fd, 0x04, 0x14},
	{0x391d, 0x14, 0x04},
	{0x391f, 0x18, 0x10},
	{0x3e23, 0x01, 0x00},
	{0x3e24, 0x3e, 0x88},
	{0x4816, 0x76, 0xb1},
	{0x4819, 0x05, 0x09},        
	{0x481b, 0x03, 0x05},        
	{0x481d, 0x0b, 0x14},        	
	{0x481f, 0x02, 0x04},        	
	{0x4821, 0x08, 0x0a},        	
	{0x4823, 0x03, 0x05},        	
	{0x4825, 0x02, 0x04},        	
	{0x4827, 0x02, 0x05},        
	{0x4829, 0x04, 0x08},
	{0x36e9, 0x20, 0x20},
	{0x36f9, 0x27, 0x24},
//	{0x0100, 0x01, 0x01}
};

static ISP_VOID cmos_fps_set(ISP_DEV IspDev, ISP_U8 u8Fps, AE_SENSOR_DEFAULT_S *pstAeSnsDft)
{
	static WDR_MODE_E sPreWdrMode[ISP_NUM_MAX] = {0xFE};
	ISP_U32 u32TotalSizeH,u32TotalSizeV;
	ISP_U8 u8i,u8Idx,u8Num;
	if(pstAeSnsDft == NULL)
	{
		return;
	}
	if(sPreWdrMode[0] == 0xFE)
	{
		for(u8i=0; u8i<ISP_NUM_MAX; u8i++)
		{
			sPreWdrMode[u8i] = 0xFF;
		}
	}
	if(WDR_MODE_2To1_LINE == gstSnsAttr[IspDev].enHdrMode)	// support linear & HDR
	{
		sensor_write_register(IspDev, 0x100, 0x00);
		genHdrModeNow[IspDev] = WDR_MODE_2To1_LINE;
		if(WDR_MODE_2To1_LINE == genHdrModeNow[IspDev])
		{
			u8Idx = 2;
			u32TotalSizeV = HDR_HD1080_25P_LINES;
			switch(u8Fps)
			{
				case 12:	u32TotalSizeH = 5280;
							break;
				case 15:
				case 30:	u32TotalSizeH = 25*2640/u8Fps;
							break;
				case 25:
				default:	u8Fps = 25;
							u32TotalSizeH = 2640;
							break;	
			}
			gau16HdrExpMax_L[IspDev] = HDR_HD1080P_EXPL_MAX;
			gau16HdrExpMax_S[IspDev] = HDR_HD1080P_EXPS_MAX;
			pstAeSnsDft->u32FullLinesStd = u32TotalSizeV ;
			pstAeSnsDft->u32LinesPer500ms = pstAeSnsDft->u32FullLinesStd*u8Fps; // 12.5fps	4xVTS(/2)
			pstAeSnsDft->u32MinIntTime = 1; 	// IntTime*4+1	
			pstAeSnsDft->u32MaxIntTime = gau16HdrExpMax_L[IspDev];	
			//XM_MPI_ISPAPP_PllSet(WDR_MODE_2To1_LINE);
		}
		else
		{
			u8Idx = 1;
			u32TotalSizeV = HD1080_25P_LINES;
			switch(u8Fps)
			{
				case 12:	u32TotalSizeH = 5280;
							break;
				case 15:
				case 30:	u32TotalSizeH = 25*2640/u8Fps;
							break;
				case 25:
				default:	u8Fps = 25;
							u32TotalSizeH = 2640;
							break;	
			}
			pstAeSnsDft->u32FullLinesStd = u32TotalSizeV ;
			pstAeSnsDft->u32LinesPer500ms = pstAeSnsDft->u32FullLinesStd*u8Fps;
			pstAeSnsDft->u32MinIntTime = 2;
			pstAeSnsDft->u32MaxIntTime = gau16HdrExpMax_L[IspDev]-LINEAR_MAX_SHUTTER_OFST; 
			gau16HdrExpMax_L[IspDev] = pstAeSnsDft->u32MaxIntTime;
			gau16HdrExpMax_S[IspDev] = 0xFFFF;
			//XM_MPI_ISPAPP_PllSet(WDR_MODE_NONE);
		}
		if(sPreWdrMode[IspDev] != genHdrModeNow[IspDev])
		{
			u8Num = sizeof(gau16FpsMode_Hdr)/sizeof(gau16FpsMode_Hdr[0]);
			for(u8i=0;u8i<u8Num;u8i++)
			{
				sensor_write_register(IspDev, gau16FpsMode_Hdr[u8i][0], gau16FpsMode_Hdr[u8i][u8Idx]);
			}
			sPreWdrMode[IspDev] = genHdrModeNow[IspDev];
		}
		if(gau32ShutNow[IspDev]>gau16HdrExpMax_L[IspDev])
		{
			cmos_inttime_update(IspDev, gau16HdrExpMax_L[IspDev]);
		}
		if(gau32ShutShortNow[IspDev]>gau16HdrExpMax_S[IspDev])
		{
			cmos_inttime_short_update(IspDev, gau16HdrExpMax_S[IspDev]);
		}
		sensor_write_register(IspDev, 0x320c, (u32TotalSizeH>>9)&0xFF);
		sensor_write_register(IspDev, 0x320d, (u32TotalSizeH>>1)&0xFF);
		sensor_write_register(IspDev, 0x320e, (u32TotalSizeV>>8)&0xFF);
		sensor_write_register(IspDev, 0x320f, (u32TotalSizeV>>0)&0xFF);
		sensor_write_register(IspDev, 0x100, 0x01);
		XM_MPI_ISP_USleep(10000);
	}
	else													// just support linear
	{
		u32TotalSizeV = HD1080_25P_LINES;
		switch(u8Fps)
		{
			case 26:	u8Fps = 25;
						u32TotalSizeV = 1126;
						u32TotalSizeH = 2640;
						break;
			case 31:
	u8Fps = 30;
						u32TotalSizeV = 1126;
						u32TotalSizeH = 2200;
						break;
			case 30:	
						if(gstSnsAttr[IspDev].enRsltType == P720_)
						{
							u32TotalSizeV = P720_25P_LINES;
							u32TotalSizeH = 2000;
							sensor_write_register(IspDev, 0x330b, 0x8b);
						}
						else
						{
							u32TotalSizeH = 2200;
						}
						break;
			case 25:
			default:	u8Fps = 25;
						if(gstSnsAttr[IspDev].enRsltType == P720_)
						{
							u32TotalSizeV = P720_25P_LINES;
							u32TotalSizeH = 2400;
							sensor_write_register(IspDev, 0x330b, 0x88);
						}
						else
						{
							u32TotalSizeH = 2640;
						}
						break;
		
		}
		gau16FullLines[IspDev] = u32TotalSizeV;
		gau16HdrExpMax_L[IspDev] = u32TotalSizeV-LINEAR_MAX_SHUTTER_OFST;
		gau16HdrExpMax_S[IspDev] = 1; 
		if(pstAeSnsDft != NULL)
		{
			pstAeSnsDft->u32FullLinesStd = u32TotalSizeV;
			pstAeSnsDft->u32MaxIntTime = gau16HdrExpMax_L[IspDev];
			pstAeSnsDft->u32LinesPer500ms = pstAeSnsDft->u32FullLinesStd * u8Fps / 2;
		}
		sensor_write_register(IspDev, 0x320c, (u32TotalSizeH>>9)&0xFF);
		sensor_write_register(IspDev, 0x320d, (u32TotalSizeH>>1)&0xFF); 
		sensor_write_register(IspDev, 0x320e, (u32TotalSizeV>>8)&0xFF);
		sensor_write_register(IspDev, 0x320f, (u32TotalSizeV>>0)&0xFF);
	}
	XM_MPI_MIPI_RefreshFV(IspDev,0, u32TotalSizeV);
	return;
}




/****************************************************************************
* AWB
****************************************************************************/
static const ISP_COLORMATRIX_AUTO_S g_stAwbCcm =
{
	5000,
	{
		0x0000, 328,  -69,  -3,
		0x0000, -67,  370,  -47,
		0x0000, -4,   -59,  319
	},
	4000,
	{
		0x0000, 367,  -115,  4,
		0x0000, -82,  394,	-56,
		0x0000, 10,   -139,  385
	},
	2800,
	{
		0x0000, 318,  -26,  -36,
		0x0000, -124,	457,	-77,
		0x0000, -79,   -59,  394
	}
};

static const ISP_AWB_CALIBRATION_V2_S gstAwbCal = {
	{0, 0, 4096, 2672, 4096, 2258, 860, 4096},
	{4096, 4096, 0, 0, 3564, 3158, 4096, 1155},
	{-245, -3637, -1286, -4096, -2784, -4096, -1120, -2055},
	213,
	0, 1464, 0, 2415,
	{0, 418, 663, 1040, 1150, 1309, 1524, 1548, 2415, 0, 0, 0, 0, 0, 0, 0},
	{2000, 2150, 2800, 4000, 4150, 5000, 6500, 7500, 12000, 0, 0, 0, 0, 0, 0, 0},
 	{1852, 1024, 2033, 0}
};

static ISP_S32 cmos_get_awb_default(ISP_DEV IspDev, AWB_SENSOR_DEFAULT_S *pstAwbSnsDft)
{
	if (ISP_NULL == pstAwbSnsDft)
	{
		ERR("null pointer when get awb default value!\n");
		return ISP_FAILURE;
	}
	XM_MPI_ISP_Memset((ISP_U8*)pstAwbSnsDft, 0, sizeof(AWB_SENSOR_DEFAULT_S));
	pstAwbSnsDft->pstAwbCal = &gstAwbCal;
	// CCM
	XM_MPI_ISP_Memncpy((ISP_U8*)&(pstAwbSnsDft->stCcm), (ISP_U8*)&g_stAwbCcm, sizeof(ISP_COLORMATRIX_AUTO_S));
	return ISP_SUCCESS;
}


/****************************************************************************
 * callback structure                                                       *
 ****************************************************************************/
 ISP_S32 cmos_init_chn_sc200AI(ISP_DEV IspDev)
{
	return 0;
}
 
ISP_S32 cmos_init_sensor_exp_function_sc200AI(ISP_SENSOR_EXP_FUNC_S *pstSensorExpFunc)
{
	XM_MPI_ISP_Memset((ISP_U8 *)pstSensorExpFunc, 0, sizeof(ISP_SENSOR_EXP_FUNC_S));
	pstSensorExpFunc->pfn_cmos_sensor_init = sensor_init;
	pstSensorExpFunc->pfn_cmos_get_isp_default = cmos_get_isp_default;
	pstSensorExpFunc->pfn_cmos_set_pixel_detect = cmos_set_pixel_detect;
	pstSensorExpFunc->pfn_cmos_get_sensor_max_resolution = cmos_get_sensor_max_resolution;
	pstSensorExpFunc->pfn_cmos_set_mirror_flip = cmos_set_mirror_flip;
	return 0;
}

ISP_S32 cmos_init_ae_exp_function_sc200AI(AE_SENSOR_EXP_FUNC_S *pstExpFuncs)
{
	XM_MPI_ISP_Memset((ISP_U8 *)pstExpFuncs, 0, sizeof(AE_SENSOR_EXP_FUNC_S));
	pstExpFuncs->pfn_cmos_fps_get = NULL;
	pstExpFuncs->pfn_cmos_get_ae_default    = cmos_get_ae_default;
	pstExpFuncs->pfn_cmos_fps_set           = cmos_fps_set;
	pstExpFuncs->pfn_cmos_slow_framerate_set= cmos_slow_framerate_set;    
	pstExpFuncs->pfn_cmos_inttime_update    = cmos_inttime_update;
	pstExpFuncs->pfn_cmos_inttime_short_update = cmos_inttime_short_update;
	pstExpFuncs->pfn_cmos_gains_update      = cmos_gains_update;
	pstExpFuncs->pfn_cmos_again_calc_table  = cmos_again_calc_table;
	pstExpFuncs->pfn_cmos_dgain_calc_table  = cmos_dgain_calc_table;
	return 0;
}

ISP_S32 cmos_init_awb_exp_function_sc200AI(AWB_SENSOR_EXP_FUNC_S *pstExpFuncs)
{
	XM_MPI_ISP_Memset((ISP_U8*)pstExpFuncs, 0, sizeof(AWB_SENSOR_EXP_FUNC_S));
	pstExpFuncs->pfn_cmos_get_awb_default = cmos_get_awb_default;
	return 0;
}








